task yarnInstall(type: Exec) {
    inputs.file("yarn.lock")
    inputs.file("package.json")
    outputs.dir("node_modules/")

    commandLine "yarn", "install"
}

task assemble(type: Exec) {
    dependsOn yarnInstall

    inputs.file("yarn.lock")
    inputs.file("package.json")
    inputs.file("webpack.config.common.js")
    inputs.file("webpack.config.prod.js")
    inputs.file("tsconfig.json")
    inputs.dir("node_modules")
    inputs.dir("src")
    outputs.dir("build/")

    commandLine "yarn", "build", "-o", "${project.rootDir}/backend/src/main/resources/public/main.js"
}

task test(type: Exec) {
    inputs.file("yarn.lock")
    inputs.file("package.json")
    inputs.file("jest.config.js")
    inputs.file("tsconfig.json")
    inputs.dir("src")

    commandLine "yarn", "test"
}

task build {
    dependsOn test
    dependsOn assemble
}